<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>OpenSIMR</title>
<link rel="icon" href="{?=url()?}/favicon.png" type="image/x-icon">
<meta name="keywords" content="OpenSIMR">
<meta name="description" content="OpenSIMR Indonesia">
<meta name="author" content="drg. Faisol Basoro">
<link href="{?=url()?}/assets/css/bootstrap.min.css" rel="stylesheet">
<link href="{?=url()?}/assets/css/materialdesignicons.min.css" rel="stylesheet">
<link href="{?=url()?}/themes/admin/css/style.min.css" rel="stylesheet">
<link href="{?=url()?}/plugins/dashboard/css/admin/style.css" rel="stylesheet">
</head>

<body>
<div class="container-fluid">
    <div class="row">
      <div class="col-sm-6 col-md-3">
        <div class="card bg-primary">
          <div class="card-body clearfix">
            <div class="pull-left m-r-15"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-calendar-range fa-1-5x"></i></span> </div>
            <div>
              <p class="h6 text-white m-t-0">Total Kunjungan</p>
              <p class="h3 text-white m-b-0 fa-1-5x">
                {?= $stats.getVisities ?}
                <span class="text-{if: $stats.percentYear >= 0}white{else}danger{/if} stat-up-down">
                    <i class="mdi mdi-arrow-{if: $stats.percentYear >= 0}up{else}down{/if}"></i>
                    ({?= $stats.percentYear ?}%)
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="card bg-danger">
          <div class="card-body clearfix">
            <div class="pull-left m-r-15"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-calendar fa-1-5x"></i></span> </div>
            <div>
              <p class="h6 text-white m-t-0">Kunjungan Tahun Ini</p>
              <p class="h3 text-white m-b-0 fa-1-5x">
                {?= $stats.getYearVisities ?}
                <span class="text-{if: $stats.percentYear >= 0}white{else}danger{/if} stat-up-down">
                    <i class="mdi mdi-arrow-{if: $stats.percentYear >= 0}up{else}down{/if}"></i>
                    ({?= $stats.percentYear ?}%)
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="card bg-success">
          <div class="card-body clearfix">
            <div class="pull-left m-r-15"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-account-multiple fa-1-5x"></i></span> </div>
            <div>
              <p class="h6 text-white m-t-0">Kunjungan Bulan Ini</p>
              <p class="h3 text-white m-b-0 fa-1-5x">
                {?= $stats.getMonthVisities ?}
                <span class="text-{if: $stats.percentMonth >= 0}white{else}danger{/if} stat-up-down">
                    <i class="mdi mdi-arrow-{if: $stats.percentMonth >= 0}up{else}down{/if}"></i>
                    ({?= $stats.percentMonth ?}%)
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-md-3">
        <div class="card bg-purple">
          <div class="card-body clearfix">
            <div class="pull-left m-r-15"> <span class="img-avatar img-avatar-48 bg-translucent"><i class="mdi mdi-wheelchair-accessibility fa-1-5x"></i></span> </div>
            <div>
              <p class="h6 text-white m-t-0">Kunjungan Hari Ini</p>
              <p class="h3 text-white m-b-0 fa-1-5x">
                {?= $stats.getCurrentVisities ?}
                <span class="text-{if: $stats.percentDays >= 0}white{else}danger{/if} stat-up-down">
                    <i class="mdi mdi-arrow-circle-{if: $stats.percentDays >= 0}up{else}down{/if}"></i>
                    ({?= $stats.percentDays ?}%)
                </span>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-xs-12">
        <div class="card">
          <div class="card-header">
            <h4>Poliklinik Hari Ini</h4>
            <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
          </div>
          <div class="card-body">
            <canvas id="line-chartcanvas" height="350"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h4>Rawat Jalan {?=date('Y')?}</h4>
            <button type="button" class="btn btn-sm btn-info pull-right" id="ChartBars"><i class="mdi mdi-refresh"></i></button>
          </div>
          <div class="card-body" id="here">
            <canvas class="js-chartjs-bars"></canvas>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-header">
            <h4>Rawat Inap {?=date('Y')?}</h4>
            <button type="button" class="btn btn-sm btn-info pull-right" id="ChartLines"><i class="mdi mdi-refresh"></i></button>
          </div>
          <div class="card-body">
            <canvas class="js-chartjs-lines"></canvas>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
        <div class="col-lg-4 col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Status Perawatan {?=date('Y')?}</h4>
                    <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
                </div>
                <div class="card-body">
                    <canvas id="medical-treatment-chart" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Kunjungan Tahun {?=date('Y')?}</h4>
                    <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
                </div>
                <div class="card-body">
                    <canvas id="heart-surgery-chart" height="200"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4 col-md-4">
            <div class="card">
                <div class="card-header">
                    <h4>Cara Bayar Tahun {?=date('Y')?}</h4>
                    <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
                </div>
                <div class="card-body">
                    <canvas id="total-revenue-chart" height="200"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- New Patients -->
        <div class="col-md-8 col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h4>Pasien Terbaru Hari Ini</h4>
                    <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
                </div>
                <div>
                    <div class="table-responsive no-margin">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>No. RM</th>
                                    <th>Name</th>
                                    <th>Pekerjaan</th>
                                    <th>Cara Bayar</th>
                                </tr>
                            </thead>
                            <tbody>
                                {loop: $pasien}
                                <tr>
                                    <td>{$value.no_rkm_medis}</td>
                                    <td>
                                        <img src="{?=url(MODULES.'/pasien/img/'.$value.jk.'.png')?}" alt="Profile Image" width="40" height="40" style="border-radius:50%;">
                                        <div style="display:inline;padding-left:10px;padding-top:10px;">{$value.nm_pasien}</div>
                                    </td>
                                    <td>{$value.pekerjaan}</td>
                                    <td><span class="badge {if: $value.kd_pj == 'BPJ'}badge-success{/if}">{$value.png_jawab}</span></td>
                                </tr>
                                {/loop}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- End New Patients -->

        <!-- Doctors List -->
        <div class="col-md-4 col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h4>Jadwal Dokter Hari Ini</h4>
                    <button type="button" class="btn btn-sm btn-info pull-right" id=""><i class="mdi mdi-refresh"></i></button>
                </div>
                <div class="list-group">
                    {loop: $dokter}
                    <div class="list-group-item">
                        <img src="{?=url(MODULES.'/pasien/img/default.png')?}" style="border-radius:50%;float:left;" width="40">
                        <div style="display:inline-block;padding-left:10px;">
                            <b>{$value.nm_dokter}</b><br>
                            {$value.nm_sps}
                        </div>
                    </div>
                    {/loop}
                </div>
            </div>
        </div>
        <!-- End Doctors List -->

    </div>

    <div class="btn-group">
        <button class="btn btn-danger btn-fab" id="main" data-toggle="modal" data-target="#myModal">
            <i class="mdi mdi-camera-front-variant"></i> Presensi Online
        </button>
    </div>

    <!-- The Modal -->
    <div class="modal" id="myModal" data-keyboard="false" data-backdrop="static">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
              <button type="button" class="close"><a href="{?=url(ADMIN.'/dashboard/index')?}">Close <span aria-hidden="true">&times;</span></a></button>
          </div>
          <!-- Modal body -->
          <div class="modal-body">
            <center>
              <div id="camera"></div><br>
              {if: empty($cek_presensi)}
              <select class="form-control" id="shift" style="width:140px;">
                <option value="">Pilih Shift</option>
                {loop: $jam_jaga}
                <option value="{$value.shift}">{$value.shift}</option>
                {/loop}
              </select><br><br>
              {/if}
              <input type="button" class="btn btn-info" value="{if: empty($cek_presensi)}Presensi Masuk{else}Presensi Pulang{/if}" data-dismiss="modal">
              <input type="hidden" name="image" id="image-tag">
              <div id="results"></div>
            </center>
          </div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="{?=url()?}/assets/jscripts/jquery.min.js"></script>
    <script type="text/javascript" src="{?=url()?}/assets/jscripts/bootstrap.min.js"></script>
    <script type="text/javascript" src="{?=url()?}/themes/admin/js/main.min.js"></script>
    <script type="text/javascript" src="{?=url()?}/assets/jscripts/Chart.js"></script>
    <script type="text/javascript" src="{?=url()?}/assets/jscripts/Chart.js"></script>
    <script type="text/javascript" src="{?=url()?}/plugins/dashboard/js/webcam.js"></script>
    <script type="text/javascript" src="{?=url()?}/plugins/dashboard/js/app.js"></script>

    <script type="text/javascript">
        $(function () {
            //line chart
            var ctx = document.getElementById("line-chartcanvas");
            var myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ["{?= implode('","', $stats.poliChart.labels) ?}"],
                    datasets: [{
                            label: "Pasien",
                            borderColor: "#34316E",
                            borderWidth: "2",
                            backgroundColor: "rgba(30, 30, 45, 0.2)",
                            pointHighlightStroke: "#1e1e2d",
                            pointRadius: 0,
                            data: [{?= implode(',', $stats.poliChart.visits) ?}],
                        }
                    ]
                },
                options: {
                    legend: {
                        display: false
                    },
                    responsive: true,
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    maintainAspectRatio: false
                }
            });

            //Medical treatment chart
            var ctx2 = document.getElementById("medical-treatment-chart");
            var myChart2 = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ["{?= implode('","', $stats.RanapTahunChart.labels) ?}"],
                    datasets: [
                    {
                        label: "Dirawat",
                        borderColor: "#F58634",
                        borderWidth: "2",
                        backgroundColor: "transparent",
                        pointHighlightStroke: "#1e1e2d",
                        pointRadius: 0,
                        data: [{?= implode(',', $stats.RanapTahunChart.visits) ?}],
                    },
                    {
                        label: "Dirujuk",
                        borderColor: "#34316E",
                        borderWidth: "2",
                        backgroundColor: "transparent",
                        pointHighlightStroke: "#1e1e2d",
                        pointRadius: 0,
                        data: [{?= implode(',', $stats.RujukTahunChart.visits) ?}],
                    }
                    ]
                },
                options: {
                    legend: {
                        display: false
                    },
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    responsive: true,
                    maintainAspectRatio: false
                }
            });

            //Heart surgery chart
            var ctx1 = document.getElementById("heart-surgery-chart");
            var myChart1 = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ["{?= implode('","', $stats.KunjunganTahunChart.labels) ?}"],
                    datasets: [
                    {
                        label: "{?=date('Y')?}",
                        borderColor: "#F58634",
                        borderWidth: "2",
                        backgroundColor: "transparent",
                        pointHighlightStroke: "#1e1e2d",
                        pointRadius: 0,
                        data: [{?= implode(',', $stats.KunjunganTahunChart.visits) ?}],
                    }
                    ]
                },
                options: {
                    legend: {
                        display: false
                    },
                    responsive: true,
                    tooltips: {
                        mode: 'index',
                        intersect: false
                    },
                    hover: {
                        mode: 'nearest',
                        intersect: true
                    },
                    maintainAspectRatio: false
                }
            });

            //Toal Revenue Doughnut chart
            var ctx2 = document.getElementById("total-revenue-chart");
            var myChart2 = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: [
                        "Tunai",
                        "BPJS",
                        "Lain-Lain"
                    ],
                    datasets: [{
                        backgroundColor: ["#4caf50", "#34316E", "#F58634"],
                        pointRadius: 0,
                        data: [{$stats.tunai.count}, {$stats.bpjs.count}, {$stats.lainnya.count}],
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        });

        $(document).ready(function() {

            $('#shift').on('change', function() {
              var shift = this.text;
            });

            $('#myModal').on('show.bs.modal', function() {

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function success(pos) {}, function error(err) {}, {enableHighAccuracy: true, timeout: 5000});
                } else {
                    //Geolocation is not supported by this browser
                    alert('Geolocation is not supported by this browser');
                }

                Webcam.set({
                    width:240,
                    height:240,
                    image_format:'jpeg',
                    jpeg_quality:90,
                    facingMode: {
                      exact: 'environment'
                    }
                });
                Webcam.attach('#camera');
            });
            $("#myModal").on("hidden.bs.modal", function () {

                var getshift = shift.value;
                var shutter = new Audio();
                shutter.autoplay = false;
                shutter.src = navigator.userAgent.match(/Firefox/) ? '{?=url()?}/plugins/dashboard/audio/shutter.ogg' : '{?=url()?}/plugins/dashboard/audio/shutter.mp3';
                shutter.play();

                Webcam.snap(function(data_uri){
                    document.getElementById('results').innerHTML = '<img id="imageprev" src="'+data_uri+'"/>';
                });

                var base64image = document.getElementById("imageprev").src;

                Webcam.upload(base64image, '{?=url(ADMIN.'/dashboard/upload/')?}&shift=' + getshift, function(code, text) {
                });

                Webcam.reset();

                navigator.geolocation.getCurrentPosition(
                    function(position) {
                      $.post('{?=url(ADMIN.'/dashboard/geolocation/')?}', {lat: position.coords.latitude, lng: position.coords.longitude});
                    },
                    function error(err) {},
                    {enableHighAccuracy: true, timeout: 5000}
                );

                window.location.href = '{?=url(ADMIN.'/dashboard/index')?}';

            });
        });

    </script>
    <script type="text/javascript">
    $(document).ready(function(e) {
        var $dashChartBarsCnt  = jQuery( '.js-chartjs-bars' )[0].getContext( '2d' ),
            $dashChartLinesCnt = jQuery( '.js-chartjs-lines' )[0].getContext( '2d' );

        var $dashChartBarsData = {
    		labels: ['Jan', 'Peb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
    		datasets: [
    			{
    				label: 'Pasien',
                    borderWidth: 1,
                    borderColor: 'rgba(0,0,0,0)',
    				backgroundColor: 'rgba(51,202,185,0.5)',
                    hoverBackgroundColor: "rgba(51,202,185,0.7)",
                    hoverBorderColor: "rgba(0,0,0,0)",
    				data: [2500, 1500, 1200, 3200, 4800, 3500, 1500, 1500, 1200, 3200, 4800, 2500]
    			}
    		]
    	};
        var $dashChartLinesData = {
    		labels: ['Jan', 'Peb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'],
    		datasets: [
    			{
    				label: 'Pasien',
    				data: [20, 25, 40, 30, 45, 40, 55, 40, 48, 40, 42, 50],
    				borderColor: '#358ed7',
    				backgroundColor: 'rgba(53, 142, 215, 0.175)',
                    borderWidth: 1,
                    fill: false,
                    lineTension: 0.5
    			}
    		]
    	};

        new Chart($dashChartBarsCnt, {
            type: 'bar',
            data: $dashChartBarsData
        });

        var myLineChart = new Chart($dashChartLinesCnt, {
            type: 'line',
            data: $dashChartLinesData,
        });

        $("#ChartBars").on("click", function() {
            var $dashChartBarsCnt = jQuery( '.js-chartjs-bars' )[0].getContext( '2d' );
            new Chart($dashChartBarsCnt, {
                type: 'bar',
                data: $dashChartBarsData
            });
        });

        $("#ChartLines").on("click", function() {
            var $dashChartLinesCnt = jQuery( '.js-chartjs-lines' )[0].getContext( '2d' );
            new Chart($dashChartLinesCnt, {
                type: 'line',
                data: $dashChartLinesData
            });
        });

    });
    </script>
</body>
</html>
